# Developer Manual

## Critical!

Before start using this UI program, please read following information:

1. The main ui python file is located at:
   ```bash
   /Python_Folder/UI_MySQL.py
   ```

2. This program is currently running a local database, please edit the database information before running the program, which are located in two places:
   
   1.  `/Python_Folder/UI_MySQL.py >> __main__:`
      ```python
      MySQL_func = MySQL_function_class("localhost", "root", "password", "UI_database")
      ```

   2. `/Python_Folder/Object.py >> class object: >> connect_database(self):`
      ```python
        return MySQL_function_class("localhost", "root", "password", "UI_database")
      ```
   What should be replaced are `("localhost", "root", "password", "UI_database")`.


3. Run the program and check the "Admin mode" checkbox, then Login with following id 
and password:
   ```bash
   ID:         ADMIN
   PASSWORD:   Point1 
   ```

4. While adding a new users, the default password will be set as `Point1`, which the user can edit it after logging in.

5. In the editing window/tabs, the checkboxes infront of each rows are for mistake-proofing purpose, the change will be applied only when the checkbox of the row is checked, including deletion and edit.

6. In Advance UI, the table display 20 row of data per pages.

7. All the format relating information can be founded in Readme.md

8. `/UI_Folder` includes all the .ui files that were used in this program, if there's any need to edit the ui, please open the .ui file in designer.

9. `Logger.py` is a helper class that can easily generate a logger object for logging purpose, and manual regarding it is locate at end of this document.

10. `User.py` and `Plate.py` are object classes that contains necessary properties.

11. `helper_function.py` and `MySQL_function.py` are function classes.

## UI_MySQL.py file contains four Ui classes and six function classes:

## UI classes:

1. There're four Ui classes for Login (`Ui_Login()`), Register (`Ui_Register()`), normal user Info Editor (`Ui_Info_Editor()`), and Admin user info editor interface. 

2. All the UI classes are generated by Qt Designer, including in-class function: `setUpUI()` and `retranslateUi()`. 

3. Asside from the generated function, there's a `modding()` function added for modding specific behavier, if there's any need to mod any Ui classes, please mod it in `modding()` function, and make sure to call the `modding()` in the end of setUpUI(). 

4. Similarly, when regernating the Ui function, please copy and overwrite classes `setUpUI()` and `retranslateUi()`, then call the `modding()` in the end of setUpUI(). Sample code is shown below:
   ```python
           class Ui_sample(object):
           # generated code
           def setupUi(self, sample):
               ...
               self.modding()  # always add this line in to imply the mod
           
           # generated code
           def retranslateUi(self, sample):
               ...
           
           # function for all the modding, e.g. connecting button to function, hiding the 
           # labels, and etc.
           def modding(self):
               ...
   ```


## Function classes:

- Each UI class has its own function class to handle all the action, and the only exception is UI_Concentrate_Advance since it has three tabs, therefore there's three individual funcitons for each of them.

- There're two extra function classes, MySQL_function and helper_function that handles some general action, and MySQL relating action.

- Whenever any function encountered exception, it will return -1 and log the message into "Error.log".

- There are many variables that share the same name in different function, that is for convenience purpose. Therefore some of the function can simply use function's name as a parameter, and handle multiple function's action by just itself.

<br/><br/>

1. `class UI_Login_function:`

   1. `global variable`

      - `current_user:`
      User object that represent currently login user.

   2. `login(self, userid, password):`
     
      This function is connected to the login button in login_Ui, which will take the context that user types in textbox `UserID_Input` as `userid` and `password_Input`
      as `password`, checking the availability of them, and determine the login type to be recorded.
         
      No matter whether user's success or failed the login action, the record will be added into database's Login_record table.
         
      However, if the login action failed, the error message will be displayed.
         
      Regardless the type of failure, whenever login action failed, function will return a boolean value of False. 
         
      On the other hand, whenever login action success, function will return boolean value of True.
         
      Finally, regardless user login in Admin or Normal user mode, as long as the login is successful,this window (Loginui) will be closed.
      
      P.S. both parameters userid and password are string.

   3. `open_Concentrate_Advance_window(self),  open_Info_Editor_window(self):`
         
      These two functions are used for displaying the windows when user input the correct userid and password.
         
      Only one of these windows will be displayed, which depends on whether user had checked the 
      admin mode checkbox. 
         
      No return values for both of these function.

   4. `open_normal_welcome_message():`

      This function will only be called when user logins in normal mode, it will capture the userid
      and display a popup windows that ask whether user want to display the personal information 
      editing window.
         
      No return values for this function.

2. `class User_info_edit_function:`

   This function is the parent class of `UI_Info_Editor_function` and `UI_Search_Edit_function`, provides the 
   function that can be shared with both two children function class above.

   1. `__init__(self):`
      
      Initializing function that provides properties that can be used for both function classes.
      
      - `self.check_botton_array`: List variable to store the checkbox
      - `self.curernt_user`: `user` object that represent currently_login_user
      - `self.table`: `QTableWidget` object that represent display table

   2. `set_table(self, table, current_search_type, value, pages, *column_to_lock):`

      This function will capture user's information from database, then insert checkbox and user 
      information into table.
      
      No return values for this function.      

   3. `save_info(self, table):`

      This function will capture userids that were displayed on the given `table`(only capture rows that checkboxs were checked), 
      and compare the data with the stored data in database, which can be searched by userid row by row. 

      If datas in the row are valid, then those datas will be updated to database by userid.

      No return values for this function.


2. `class UI_Info_Editor_function(User_info_edit_function):`

   1. `show_user(self, pages):`

      This function will initialize `self.table` and `self.current_user`, then set up the table.
      
      No return values for this function.

   2. `press_save(self):`

      This function save the data on the table by calling `save_info()` function, then handle the error message

      Finally, refresh the table with updated data. 

      No return values for this function.


3. `class UI_Search_Edit_function(User_info_edit_function):`
   
   1. `Global variable:`
      - `user_info_pages_maximum:`
      Integer that represent the maximum pages that can be displayed in table, to
      prevent user access the pages that doesn't contains data.
      
      - `current_search_type:`
      String that represent current searching type, including `all`, `id`, etc. 
      Initially set to `all`. 
      
      - `value` 
      String that handle the specific value for searching operation later.

      - `pages`
      Integer that handle the current display page.


   2. `show_user(self, pages):`

      This function will initialize `self.table` and `self.current_user`, then set the `value`, `pages` and lastly the table.
      
      No return values for this function.

   3. `press_save(self):`

      This function save the data on the table by calling `save_info()` function, then handle the error message

      Finally, refresh the table with updated data. 

      No return values for this function.


   4. `open_Register_window(self):`

      This functions are used for opening the register windows when user press the "add a 
      user" button.
      
      No return value for this function.


   5. `show_delete_confirm(self):`

      This function will display a popup windows with confirm message, Pressing OK button will 
      call the `delete_user()` function below, while pressing Cancel will cancel the action.  
      
      No return value for this function.


   6. `delete_user(self):`

      This function will only be called when user confirm the deletion in delete_confirm window, 
      then will delete users from database (only when the mistake-proofing at its row are checked).
      
      Besides, if the users that are going to be deleted has assigned plates, this function will 
      automatically deassign those plates.

      No return value for this function.


4. `class UI_Register_function:`

   1. `press_register(self, userid, password, real_name):`

      This function will check if inputs in register window is valid. If so, then the user with 
      inputted information will be added into the database.
      
      `userid`, `password`, and `real_name` are given by parameter, while `gender` and `permission` are 
      captured by checking whether the button is checked.
      
      If the user is added successfully, this function will return a boolean value True, and 
      will return False elsewise.
      
      P.S. All parameters are string.


5. `class UI_Login_History_function:`

   1. `Global variable:`
   
      - `login_history_pages_maximum:`
      Integer that represent the maximum pages that can be displayed in table, to
      prevent user access the pages that doesn't contains data.
      
      - `current_search_type:`
      String that represent current searching type, including `all`, `id`, etc. 
      Initially set to `all`

      - `value` 
      String that handle the specific value for searching operation later.

   2. `show_login_history(self, pages):`
      This function will capture user's information from database according to the current 
      searching type and the interger `page` parameter, which represent the page number.
      
      No return value for this function.                



6. `class UI_Plate_info_function:`

   1. `Global variable:`

      - `login_history_pages_maximum:`
      Integer that represent the maximum pages that can be displayed in table, to
      prevent user access the pages that doesn't contains data.
      
      - `current_search_type:`
      String that represent current searching type, including `all`, `user_id`, etc. 
      Initially set to `all`
      
      - `check_button_array_search_edit:`
      List to store the index of row that mistake_proofing checkbox is checked. 

      - `current_user:`
      User object that represent currently login user.

      - `value` 
      String that handle the specific value for searching operation later.      

      - `pages`
      Integer that handle the current display page.

   2. `show_plate_info(self, pages):`

      This function will capture plate information from database according to the `current_searching_type` and the integer `page` parameter, which represent the page number, then insert checkbox row by row.
            
      No return value for this function. 

   3. `show_add_new_plate_window(self):`

      This function will display a popup windows with text edit box, user can either typing the 
      plate id and press "OK" button (or press return key on keyboard), or scan the barcode on plate
      with barcode scanner. 
      
      Both actions above will add the plate with given id into the database, with default 
      values: 
      
      `Available_for_assign == TRUE, Last_Assign_Time == NONE, Last_Deassign_Time == NONE`
      
      This function performed a recursion, until user press "Cancel" button, or press "OK" button 
      without input. 


   4. `show_confirm_window(self, title, text, action):`
      
      This function will display a popup windows with confirm message of given `title` and `text`, 
      Pressing OK button will run the `action`, while pressing Cancel will cancel the `action``.  
      
      No return value for this function. 
      

   5. `plate_action(self, mode, userid):`

      This function handle all the plate regarding action, and the integer parameter `mode` tells which action this function should perform:

      ```
      mode = 0 for deassign the plate from user.
      mode = 1 for remove the plate.
      mode = 2 for assign the plate to user.
      ```
      
      No return value for this function. 
   

   6. `show_assign_plate_to_user_window(self):`

      This function will display a popup windows with text edit box, which user can type the userid 
      in.
      
      After the "OK" button is pressed, the plates that its row's mistake-proofing checkbox is 
      checked, and `Available_for_assign` of that plate is `TRUE`, will be assigned to the user. 
      Then update user's plate number in database.
      
      If the userid doesn't exist, then the action will fail and display the error message.
      
      No return value for this function. 



<br/><br/>

## helper_function.py

1. `class helper_function_class:`

   1. `encode_password(self, password):`

      This function will encode the parameter `password` in md5, then return the encoded string.

      P.S. Parameter "password" is a string desired to be encoded.


   2. `get_time(self):`

      This function returns current time.

   3. `lock_the_Column(self, display_table, lock_column):`

      This function makes the `display_table`'s `lock_column` read only.

      P.S. Patameter `display_table` is a `Qtablewidget` that like to mod, while `lock_column` is an
      Integer that stands for the number of column to be locked.

      No return value for this function. 


   4. `has_capital_letters(self, password):,
      has_lower_letters(self, password), 
      has_numbers(self, password), 
      has_invalid_hcaracter(self, password):`

      These function are used to check each properties that a valid password or userid should have,
      will be used in the following `check_password_availability()` function, and returns a boolean 
      values.
      
      P.S. Parameter `password` is a String to be checked if it contains all the above properties.


   5. `check_password_availability(self, password):`

      This function will check if the password is availability by calling the `has......` function 
      above, and returns a boolean value.
      
      P.S. Parameter `password` is a String to be checked if it's valid.


   6. `insert_data_into_table(self, display_table, data, function_class):`

      Depends on the `display_table` (QTableWidget object) parameter that get passed into this 
      function, it will insert list object `data` and checkboxes corresponding to passed 
      `display_table`.
      
      No return value for this function. 


   7. `insert-checkbox(self, function_class, display_table, data):`

      This function will insert checkbox into the given display_table (QTableWidget object) in given 
      `function_class` (function object). 
      
      Then, store the checkbox into the list `.check_button_array` that all the function class that
      needed checkbox has. 
      
      No return value for this function. 
      
   8. `set_current_search_type(self, function_class, type):`

      This function is a setter for `.current_search_type` in other function class, which will 
      set the `.current_search_type` in `function_class` to the `type`
      
      No return value for this function. 


   9. `get_userid_on_table_list(self, display_table):`

      This function will capture all the userid row by row in the `display_table`, then return it as a list.

   10. `get_current_edited_row(self, display_table, row):`
      
      This function will capture all the data at the given row in the `disaply_table`, then return it as a list.

   11. `compare_row_with_user(self, row, user, logger_class, current_user):`

      This function will compare the given `row` list, and the properties of given `user`. Then log it into
      
      the given `logger_class` with the message that includes which `current_user` does the editing.

      No return value for this function. 

   12. `check_if_table_has_valid_data_only(self, display_table, function_class):`

      This function will check whether the given `display_table` has invalid data (only check the row that checkbox is checked, that's where `function_class` get involved). 

      Then return a list `fit_list` that contains three boolean values of `Permission_fit`, `Gender_fit`, and `Password_fit`, which will be used to 
      handle the error message.


<br/><br/>

## MySQL_function.py

   1. `__init__(self, host, user, password, database):`
      Initializing function for getting necessary info for properties.

   2. `connect_to_database(self):`

      Connect to the target database, and returns a `MySQLConnection` (mydb).
      
      This function return the database connection `mydb`


   3. `create_table_first(self, cursor):`

      create three table: `User_Information`, `Login_record`, and `Plate_Information` if not exist.
      
      The paramater `cursor` is a MySQLcursor, which can be defined by `mydb.cursor()` before calling
      the function.
      
      No return value for this function. 


   4. `check_if_user_info_is_emtpy(self):`

      create a user with default values (`userid = "ADMIN"`, `password = "Point1"`, and 
      `permission = "ADMIN"`) if there's no user exists in `User_information` table.
      
      No return value for this function. 
      

   5. `check_ID_action(self, mode, userid, password, table):`

      These functions will check the properties of `userid` from database's `table` according to 
      the integer parameter `mode`.
         ```
         mode = 0 for checking "userid" and "password" matches or not.
         mode = 1 for checking "userid" is an ADMIN or not.
         mode = 2 for checking "userid" exists or not.
         ```
      Then the function will return the corresponding bool value.
      
      P.S. Parameter `userid`, `password`, and `table` are all Strings. 


   6. `add_user(self, userid, password, permission, real_name, gender):`

      Add a user with given properties into the database.
      
      P.S. All parameters are strings, yet should follow the given format. And plate amount will be
      setted to 0 by default.
      
      No return value for this function. 


   7. `remove_user(self, userid):`

      Remove the user with given `userid` from the database.
      
      No return value for this function. 


   8. `add_login_record(self, userid, login_state, type):`

      Add a record into the database with given `userid`, `state`, and specific `type`.
      
      P.S. All parameters are strings, yet should follow the given format.
      
      No return value for this function. 


   9. `update_data_to_user_info(self, userid, password, permission, real_name, gender):`

      Update the user information in database that matches `userid` with given `password`, 
      `permission`, `real_name` and `gender`.
      
      All parameters are strings, yet should follow the given format.
      
      No return value for this function. 


   10. `add_new_plate(self, plateid):`

      Add a plate with given string parameter `plateid`, and default value of:
         ```
         Last_Assigned_User_ID = "NONE"
         Available_for_assign = "TRUE"
         Last_Assign_Time = "NONE"
         Last_Deassign_Time = "NONE"
         ```
      into database.
      
      No return value for this function.

      
   11. `remove_plate(self, plateid):`

         Drop the plate that plateid = `plateid` from the database.
         
         No return value for this function.
   

   12. `deassign_assign_plate_to_user(self, mode, plateid, userid):`

         This function will deassign or assign plates from or to user, according to the integer 
         parameter `mode`.
   
         ```
         mode = 0 from deassign plate from user.
         mode = 1 from assign plate to user.
         ```
         
         Deassign plate will update the plate's availability with given `plateid` to `TRUE`, and 
         update `LAST_DEASSIGN_TIME` to current time.
         
         Assign plate will update the plate's availability with given `plateid` to `FALSE`, and 
         update `LAST_ASSIGN_TIME` to current time.
         
         Finally, logs the message to the logging file.
         
         No return value for this function. 
         

   13. `update_plate_user_have(self, userid):`
      
         Update the number of plate that user's id = `userid` by checking the database. 
         
         No return value for this function. 
      
   
   14. `get_data_from_database(self, table, type, value, pages):`
   
         This function will get the data from given `table` in database according to the given string 
         parameters `type`, `value`, and `pages`, where `type` represents the searching type and 
         `value` the specific value that can be search under the type. 
         
         For instance, when `type` is `id`, then value will be the actual id text that user input.
         
         Finally, fetch the data into a list as a return value.
      
   
   15. `get_row_number_from_database(self, table, type, value):`
   
         Get the number of row that each `table` in database has, fetching it to an Integer then 
         returns.
         
         The `type` and `value` are the same as `get_data_from_database()` function above, 


   16. `get_pages_maximum(self, function_class, table):`

         This function get the number of data that database's table have according to the 
         `current_search_type` of given `function_class`, then divides them by 20 to get the 
         page number (Integer) and return it.
         
         The "table" variable is a String, which will be used by passing the tables name that were 
         declared in `__main__`. 

   17. `update_row_to_database(self, row):`

         This function will update the database with given list `row`.

         No return value for this function. 

<br/><br/>

## Object.py
 
   1. `class object:`
   
      This is the parent class of following two class, `user()` and `plate()`.

      If there's any chance to use object, user, or plate class only(aside from the login UI), in oder to connect the database correctly, please make sure to include the `MySQL_function_class` in the directory also. 

      1. `connect_database(self):`
         This function will connect to the database with given info `("localhost", "root", "password", "UI_database")`, to connect to other database, modify this part is required.

   2. `class user(object):`

      This is the child class of object class.

      Whenever a `user` is created, it will automatically connect to the database (with `connect_database()` function), and fill-in the properties with the data captured from database by `userid`. 

      1. `Properties:`
         - `userid`, a String that follows format given in `Readme.md`
         - `password`, a String that follows format given in `Readme.md`
         - `permission`, a String that should only be "ADMIN" or "USER"
         - `name`, a String without restriction.
         - `gender`, a String that should only be "MALE", "FEMALE", or "OTHERS"
         - `plate`, a list that contains plates id that were assigned to this user
         - `plate_num`, an Integer that shows number of plates that were assigned to this user
         - `exist`, a boolean that represent whether this user exists in database or not 

      2. `_init_(self, userid):`
      
         Initializing function that generate a user object with given `userid` and initialize the rest of the properties.

         Connect to the database by calling the parent function.

         Then, assign value to the rest of properties by `SetUserInfo()`
         
      3. `SetUserInfo(self):`

         This function will get datas from database, and assign them to `user`'s properties.

         This function also work as a checker for the existance of `userid` in database.

         If `userid` doesn't exist in database, return False, otherwise return True.

      3. `get_plate_id_user_have(self):`
      
         This function get the `plate_id` of the plate that this user had got assigned, 
         which will be used for deassiging while deleting the user that still has plates assigned to. 
         
         The return value is a list that contains all the `plate_id` of the plate that belongs to this 
         user.

   3. `class plate(object):`
      
      This is the child of object class too.

      Whenever a `plate` is created, it will automatically connect to the database (with `connect_database()` function), and fill-in the properties with the data captured from database by `plateid`. 


      1. `Properties:`

         - `plateid`, a String without restriction.
         - `LastAssignedUserID`, a String that follows format given in `Readme.md`
         - `availability`, a String that should only be "True" or "FALSE"
         - `LastAssignedTime`, a String that represent the last assigned time
         - `LastDeassignedTime`, a String that represent the last deassigned time
         - `exist`, a boolean that represent whether this user exists in database or not 

      2. `_init_(self, plateid):`
      
         Initializing function that generate a user object with given `plate` and initialize the rest of the properties.

         Connect to the database by calling the parent function.

         Then, assign value to the rest of properties by `SetPlateInfo()`
         

      3. `SetPlateInfo(self):`

         This function will get datas from database, and assign them to `plate`'s properties.

         This function also work as a checker for the existance of `plateid` in database.

         If `plateid` doesn't exist in database, return False, otherwise return True.



<br/><br/>

## Logger.py:
   
   1. `class logger_class:`

      1. `__init__(self, logger_name, level, path):`

         Initializing function that set the necessary properties with given parameter.

   - This class is a simple logging class that provides easier logging experience. 
   
   - To use this loggin class, create a logger object with desired parameter. 
   
   - For instance, to create a logger named: `TestLogger` with a level of `INFO` and located at `Log_Folder/Test.log`,
   
   - You will have to declare a variable like following:
   
      - ```python
        TestLogger = logger_class("test_logger", logging.INFO, "Log_Folder/Test.log")
        ```
   
   - Then, to log the message into log file, call the created logger with .logger, then you will be able to log the message with desired level.
   
   - For instance to log a message into log file at `info` level, you will have to do it like:
   
      - `TestLogger.logger.info("This is a test info message")`
